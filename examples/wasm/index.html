<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Computational Engine WASM Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #007bff;
            padding-bottom: 10px;
        }
        .demo-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            color: #007bff;
            margin-top: 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border-left: 4px solid #007bff;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
        }
        .output {
            background: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            min-height: 50px;
        }
    </style>
</head>
<body>
    <h1>ðŸ§® Computational Engine WASM Demo</h1>

    <div class="demo-section">
        <h2>Version Info</h2>
        <button onclick="showVersion()">Show Version</button>
        <div id="version-output" class="output"></div>
    </div>

    <div class="demo-section">
        <h2>Solve Equations</h2>
        <p>Enter equation(s) to solve:</p>
        <input type="text" id="equation-input" placeholder="x^2 - 4 = 0" value="x^2 - 4 = 0">
        <button onclick="solveEquation()">Solve</button>
        <div id="solve-output" class="output"></div>
    </div>

    <div class="demo-section">
        <h2>Differentiate</h2>
        <p>Expression:</p>
        <input type="text" id="diff-expr" placeholder="x^3 + 2*x^2 - 5*x + 1" value="x^3 + 2*x^2 - 5*x + 1">
        <p>With respect to:</p>
        <input type="text" id="diff-var" placeholder="x" value="x">
        <button onclick="differentiate()">Differentiate</button>
        <div id="diff-output" class="output"></div>
    </div>

    <div class="demo-section">
        <h2>Integrate</h2>
        <p>Expression:</p>
        <input type="text" id="int-expr" placeholder="x^2" value="x^2">
        <p>With respect to:</p>
        <input type="text" id="int-var" placeholder="x" value="x">
        <button onclick="integrate()">Integrate</button>
        <div id="int-output" class="output"></div>
    </div>

    <div class="demo-section">
        <h2>Analyze (Simplify/Expand)</h2>
        <p>Expression:</p>
        <input type="text" id="analyze-expr" placeholder="(x + 1)^2" value="(x + 1)^2">
        <p>Operation:</p>
        <select id="analyze-op">
            <option value="Simplify">Simplify</option>
            <option value="Expand">Expand</option>
            <option value="Factor">Factor</option>
        </select>
        <button onclick="analyze()">Analyze</button>
        <div id="analyze-output" class="output"></div>
    </div>

    <div class="demo-section">
        <h2>Raw JSON Request</h2>
        <p>Send a raw JSON request:</p>
        <textarea id="json-input" rows="6">
{
  "tool": "solve",
  "input": {
    "equations": ["x^2 - 9 = 0"]
  }
}</textarea>
        <button onclick="sendJsonRequest()">Send Request</button>
        <div id="json-output" class="output"></div>
    </div>

    <div class="demo-section">
        <h2>List Operations</h2>
        <button onclick="listOperations()">List All Operations</button>
        <div id="ops-output" class="output"></div>
    </div>

    <script type="module">
        import init, { ComputationalEngine } from '../../pkg/web/computational_engine.js';

        // Initialize WASM module
        let engine;

        async function initialize() {
            await init();
            engine = new ComputationalEngine();
            console.log('Computational Engine initialized!');
            document.getElementById('version-output').textContent =
                'Ready! Click "Show Version" to see version info.';
        }

        // Make functions available globally
        window.engine = null;

        window.showVersion = () => {
            if (!engine) {
                alert('Engine not initialized yet!');
                return;
            }
            const version = engine.version();
            document.getElementById('version-output').textContent =
                `Version: ${version}`;
        };

        window.solveEquation = () => {
            if (!engine) {
                alert('Engine not initialized yet!');
                return;
            }
            const equation = document.getElementById('equation-input').value;
            const output = document.getElementById('solve-output');

            try {
                const result = engine.solve({
                    equations: [equation]
                });
                output.innerHTML = `<pre>${JSON.stringify(result, null, 2)}</pre>`;
            } catch (e) {
                output.innerHTML = `<pre style="color: red;">Error: ${e}</pre>`;
            }
        };

        window.differentiate = () => {
            if (!engine) {
                alert('Engine not initialized yet!');
                return;
            }
            const expr = document.getElementById('diff-expr').value;
            const variable = document.getElementById('diff-var').value;
            const output = document.getElementById('diff-output');

            try {
                const result = engine.differentiate({
                    expression: expr,
                    variables: [variable]
                });
                output.innerHTML = `<pre>${JSON.stringify(result, null, 2)}</pre>`;
            } catch (e) {
                output.innerHTML = `<pre style="color: red;">Error: ${e}</pre>`;
            }
        };

        window.integrate = () => {
            if (!engine) {
                alert('Engine not initialized yet!');
                return;
            }
            const expr = document.getElementById('int-expr').value;
            const variable = document.getElementById('int-var').value;
            const output = document.getElementById('int-output');

            try {
                const result = engine.integrate({
                    expression: expr,
                    variable: variable
                });
                output.innerHTML = `<pre>${JSON.stringify(result, null, 2)}</pre>`;
            } catch (e) {
                output.innerHTML = `<pre style="color: red;">Error: ${e}</pre>`;
            }
        };

        window.analyze = () => {
            if (!engine) {
                alert('Engine not initialized yet!');
                return;
            }
            const expr = document.getElementById('analyze-expr').value;
            const op = document.getElementById('analyze-op').value;
            const output = document.getElementById('analyze-output');

            try {
                const result = engine.analyze({
                    expression: expr,
                    operation: op
                });
                output.innerHTML = `<pre>${JSON.stringify(result, null, 2)}</pre>`;
            } catch (e) {
                output.innerHTML = `<pre style="color: red;">Error: ${e}</pre>`;
            }
        };

        window.sendJsonRequest = () => {
            if (!engine) {
                alert('Engine not initialized yet!');
                return;
            }
            const jsonStr = document.getElementById('json-input').value;
            const output = document.getElementById('json-output');

            try {
                const result = engine.processJson(jsonStr);
                const parsed = JSON.parse(result);
                output.innerHTML = `<pre>${JSON.stringify(parsed, null, 2)}</pre>`;
            } catch (e) {
                output.innerHTML = `<pre style="color: red;">Error: ${e}</pre>`;
            }
        };

        window.listOperations = () => {
            if (!engine) {
                alert('Engine not initialized yet!');
                return;
            }
            const output = document.getElementById('ops-output');

            try {
                const ops = engine.listOperations();
                output.innerHTML = `<pre>${JSON.stringify(ops, null, 2)}</pre>`;
            } catch (e) {
                output.innerHTML = `<pre style="color: red;">Error: ${e}</pre>`;
            }
        };

        // Initialize on load
        initialize().then(() => {
            window.engine = engine;
        });
    </script>
</body>
</html>
